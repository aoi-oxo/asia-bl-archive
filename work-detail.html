<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ΩúÂìÅË©≥Á¥∞ | Asia BL Archive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: #f5f5f5;
            color: #2c2c2c;
            line-height: 1.6;
        }

        header {
            background: white;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 400;
            color: #2c2c2c;
            font-family: 'Georgia', 'Yu Mincho', 'Hiragino Mincho ProN', serif;
            letter-spacing: 1px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.5rem;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 2rem;
            transition: all 0.3s;
        }

        .back-button:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .detail-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            visibility: hidden;
            /* Hide until content is ready */
        }

        #notFoundMessage {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            text-align: center;
            display: none;
            /* Hidden by default */
        }

        .main-visual {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .main-visual img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .main-visual-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            opacity: 0.3;
        }

        .main-visual-placeholder svg {
            width: 80px;
            height: 80px;
            fill: white;
        }

        .work-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .work-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2c2c2c;
        }

        .work-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            color: #666;
            font-size: 0.95rem;
        }

        .work-meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #2c2c2c;
        }

        /* ÈÖç‰ø°„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† */
        .platform-group {
            margin-bottom: 1.5rem;
        }

        .platform-group:last-child {
            margin-bottom: 0;
        }

        .platform-label {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 0.8rem;
            font-weight: 500;
        }

        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.8rem;
        }

        .platform-btn {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .platform-btn.available {
            background: #667eea;
            color: white;
        }

        .platform-btn.available:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .platform-btn.upcoming {
            background: #f0f0f0;
            color: #666;
        }

        .platform-btn.upcoming:hover {
            background: #e8e8e8;
        }

        .platform-name {
            font-weight: 600;
        }

        .platform-status {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        /* „Ç´„É¨„É≥„ÉÄ„Éº„Éú„Çø„É≥ */
        .calendar-btn {
            width: 100%;
            padding: 1rem;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .calendar-btn:hover {
            background: #667eea;
            color: white;
        }

        /* „ÅÇ„Çâ„Åô„Åò */
        .synopsis {
            line-height: 1.8;
            color: #444;
        }

        /* „Ç≠„É£„Çπ„Éà */
        .cast-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .cast-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s;
        }

        .cast-item:hover {
            background: #f0f0f0;
            transform: translateX(4px);
        }

        .cast-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            font-size: 0.8rem;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }

        .cast-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cast-photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cast-photo-placeholder svg {
            width: 35px;
            height: 35px;
            fill: white;
        }

        .cast-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .cast-arrow {
            margin-left: auto;
            color: #999;
        }

        /* ÈÖç‰ø°„Çπ„Ç±„Ç∏„É•„Éº„É´ */
        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .schedule-item {
            display: grid;
            grid-template-columns: 60px 1fr 140px;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            align-items: center;
        }

        .episode-num {
            font-weight: 700;
            color: #667eea;
            font-size: 0.9rem;
        }

        .episode-title {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .episode-date {
            text-align: right;
            color: #666;
            font-size: 0.85rem;
        }

        /* Èñ¢ÈÄ£‰ΩúÂìÅ */
        .related-works {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .related-card {
            background: white;
            border: 1px solid #e8e0e8;
            border-radius: 8px;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .related-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .related-thumbnail {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            position: relative;
            overflow: hidden;
        }

        .related-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .related-thumbnail-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            opacity: 0.4;
        }

        .related-thumbnail-placeholder svg {
            width: 40px;
            height: 40px;
            fill: white;
        }

        .related-info {
            padding: 1rem;
        }

        .related-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .related-meta {
            font-size: 0.8rem;
            color: #999;
        }

        @media (max-width: 768px) {
            .detail-container {
                padding: 1rem;
            }

            .main-visual {
                height: 250px;
            }

            .work-title {
                font-size: 1.5rem;
            }

            .platform-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .schedule-item {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .episode-date {
                text-align: left;
            }

            .related-works {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">Asia BL Archive</div>
    </header>

    <a href="index.html" class="back-button">
        ‚Üê TOP„Å´Êàª„Çã
    </a>

    <div id="notFoundMessage">
        <div class="work-header">
            <h1 class="work-title">‰ΩúÂìÅ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</h1>
            <p style="margin-top: 1rem;">„ÅäÊé¢„Åó„ÅÆ‰ΩúÂìÅ„ÅØË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇURL„ÅåÊ≠£„Åó„ÅÑ„Åã„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        </div>
    </div>

    <div class="detail-container">
        <!-- „É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´ -->
        <div class="main-visual" id="mainVisual">
            <div class="main-visual-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path
                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                </svg>
                <div>„É°„Ç§„É≥„Éì„Ç∏„É•„Ç¢„É´</div>
            </div>
        </div>

        <!-- ‰ΩúÂìÅ„Éò„ÉÉ„ÉÄ„Éº -->
        <div class="work-header">
            <h1 class="work-title" id="workTitle"></h1>
            <div class="work-meta" id="workMeta">
            </div>
        </div>

        <!-- ÈÖç‰ø°„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† -->
        <div class="section">
            <h2 class="section-title">üì∫ „Å©„Åì„ÅßË¶≥„Çå„ÇãÔºü</h2>
            <div id="platformSection">
                <!-- JS will populate this -->
            </div>
        </div>

        <!-- „Ç´„É¨„É≥„ÉÄ„ÉºËøΩÂä†„Éú„Çø„É≥ -->
        <div class="section">
            <button class="calendar-btn" id="calendarBtn">
                üìÖ „Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†„Åô„Çã
            </button>
        </div>

        <!-- „ÅÇ„Çâ„Åô„Åò -->
        <div class="section">
            <h2 class="section-title">„ÅÇ„Çâ„Åô„Åò</h2>
            <p class="synopsis" id="synopsis"></p>
        </div>

        <!-- „Ç≠„É£„Çπ„Éà -->
        <div class="section">
            <h2 class="section-title">„Ç≠„É£„Çπ„Éà</h2>
            <div class="cast-list" id="castList"></div>
        </div>

        <!-- ÈÖç‰ø°„Çπ„Ç±„Ç∏„É•„Éº„É´ -->
        <div class="section">
            <h2 class="section-title">ÈÖç‰ø°„Çπ„Ç±„Ç∏„É•„Éº„É´</h2>
            <div class="schedule-list" id="scheduleList">
                <!-- JS„ÅßÁîüÊàê -->
            </div>
        </div>

        <!-- Èñ¢ÈÄ£‰ΩúÂìÅ -->
        <div class="section">
            <h2 class="section-title">„Åì„Å°„Çâ„ÇÇ„Åä„Åô„Åô„ÇÅ</h2>
            <div class="related-works" id="relatedWorks">
                <!-- JavaScript„ÅßËá™ÂãïÁîüÊàê -->
            </div>
        </div>
    </div>


    <script>
        window.addEventListener("load", async () => {

// „Åì„Åì„Å´Êñ∞„Åó„ÅÑfetch„Ç≥„Éº„Éâ„ÇíÊõ∏„Åè
const urlParams = new URLSearchParams(window.location.search);
const workId = urlParams.get("id");

if (!workId) {
  displayNotFound();
  return;
}

try {
    const response = await fetch(
  `https://script.google.com/macros/s/AKfycbyPRP7mexaSIblweHtcpIeHJUf0TWfAibaZTdSJ4Sl7ZFLJVsM-IiygTU9-yQ2gd5g6WA/exec?id=${workId}`
);




  if (!response.ok) {
    throw new Error("API error");
  }

  const data = await response.json();

  const work = data.find(item => String(item.ID).trim() === String(workId).trim());


if (!work) {
  displayNotFound();
  return;
}

renderWorkDetails(work, [], []);

} catch (error) {
  console.error("ÂèñÂæó„Ç®„É©„Éº:", error);
  displayNotFound();
}

        });

        function displayNotFound() {
            document.getElementById('notFoundMessage').style.display = 'block';
            document.querySelector('.detail-container').style.display = 'none';
        }

        const renderWorkDetails = (work, allActors, allWorks) => {
            const displayTitle = work.Title_JP || work.Title_EN || work.Title_Native;
            document.title = `${displayTitle || '‰ΩúÂìÅË©≥Á¥∞'} | Asia BL Archive`;

            if (work.Image_URL && work.Image_URL !== 'N/A') {
                document.getElementById('mainVisual').innerHTML = `<img src="${work.Image_URL}" alt="${displayTitle || ''}">`;
            }

            document.getElementById('workTitle').textContent = displayTitle || '„Çø„Ç§„Éà„É´‰∏çÊòé';

            const countryLabels = {
                'Korea': 'üá∞üá∑ ÈüìÂõΩ', 'South Korea': 'üá∞üá∑ ÈüìÂõΩ', 'Thailand': 'üáπüá≠ „Çø„Ç§',
                'Taiwan': 'üáπüáº Âè∞Êπæ', 'China': 'üá®üá≥ ‰∏≠ÂõΩ', 'Japan': 'üáØüáµ Êó•Êú¨', 'Philippines': 'üáµüá≠ „Éï„Ç£„É™„Éî„É≥'
            };
            document.getElementById('workMeta').innerHTML = `
                <div class="work-meta-item">${countryLabels[work.Country] || work.Country || 'N/A'}</div>
                <div class="work-meta-item">ÂÖ®${work.Total_Episodes || 'N/A'}Ë©±</div>
                <div class="work-meta-item">${(work.Genre || '').split(';')[0] || 'N/A'}</div>
            `;

            document.getElementById('synopsis').textContent = work.Synopsis_JP || work.Synopsis || '„ÅÇ„Çâ„Åô„ÅòÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ';

            const platformSection = document.getElementById('platformSection');
            if (work.Platform && work.Platform !== 'N/A') {
                const platforms = work.Platform.split('/').map(p => p.trim());
                platformSection.innerHTML = `
                    <div class="platform-grid">
                        ${platforms.map(platform => `
                            <a href="#" class="platform-btn available">
                                <span class="platform-name">${platform}</span>
                                <span class="platform-status">ÈÖç‰ø°‰∏≠</span>
                            </a>
                        `).join('')}
                    </div>`;
            } else {
                platformSection.innerHTML = '<p>ÈÖç‰ø°„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>';
            }

            const castList = document.getElementById('castList');
            const castNames = new Set();
            for (let i = 1; i <= 20; i++) {
                const castName = work[`Cast${i}_EN`] || work[`Cast${i}_Native`];
                if (castName && castName !== 'N/A') {
                    castNames.add(castName);
                }
            }

            if (castNames.size > 0) {
                castList.innerHTML = Array.from(castNames).map(actorName => {
                    const actor = allActors.find(a => a.Name_EN === actorName || a.Name_Native === actorName || a.Name_JP === actorName);
                    let actorPhotoHTML = `<div class="cast-photo-placeholder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>`;
                    if (actor && actor.Image_URL && actor.Image_URL !== 'N/A') {
                        actorPhotoHTML = `<img src="${actor.Image_URL}" alt="${actorName}">`;
                    }
                    const nameForLink = actor ? (actor.Name_EN || actorName) : actorName;
                    return `
                        <a href="actor-detail.html?name=${encodeURIComponent(nameForLink)}" class="cast-item">
                            <div class="cast-photo">${actorPhotoHTML}</div>
                            <div class="cast-name">${actorName}</div>
                            <div class="cast-arrow">‚Üí</div>
                        </a>
                    `;
                }).join('');
            } else {
                castList.innerHTML = '<p>„Ç≠„É£„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
            }

            const scheduleList = document.getElementById('scheduleList');
            if (work.Total_Episodes && work.Total_Episodes !== 'N/A' && parseInt(work.Total_Episodes) > 0) {
                scheduleList.innerHTML = Array.from({ length: parseInt(work.Total_Episodes) }, (_, i) => `
                    <div class="schedule-item">
                        <div class="episode-num">Á¨¨${i + 1}Ë©±</div>
                        <div class="episode-title">${displayTitle || '„Ç®„Éî„ÇΩ„Éº„Éâ'}</div>
                        <div class="episode-date">${work.Year || 'N/A'}</div>
                    </div>
                `).join('');
            } else {
                scheduleList.innerHTML = '<p>ÈÖç‰ø°„Çπ„Ç±„Ç∏„É•„Éº„É´ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
            }

            document.querySelector('.detail-container').style.visibility = 'visible';
        };
    </script>
</body>

</html>