# Asia BL Archive - 開発引き継ぎドキュメント（Re-anchor Document）

**最終更新日:** 2026年2月16日  
**プロジェクトオーナー:** aoi (aoi-oxo)  
**プロジェクト期間:** 2026年2月11日〜進行中  
**ドキュメント作成者:** Claude (Anthropic)

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [現在の進捗状況](#2-現在の進捗状況)
3. [技術スタック](#3-技術スタック)
4. [ディレクトリ構造](#4-ディレクトリ構造)
5. [データ構造](#5-データ構造)
6. [環境設定](#6-環境設定)
7. [実装済み機能](#7-実装済み機能)
8. [未実装機能](#8-未実装機能)
9. [開発フロー](#9-開発フロー)
10. [トラブルシューティング](#10-トラブルシューティング)
11. [次のステップ](#11-次のステップ)
12. [重要な技術的詳細](#12-重要な技術的詳細)

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Asia BL Archive**

### 1.2 目的
アジア（タイ・台湾・韓国・中国・日本）の実写BLドラマを網羅するアーカイブサイト。作品情報と俳優情報を体系的に整理し、ファンが簡単に検索・閲覧できるようにする。

### 1.3 主な機能
- 作品一覧表示（国別・年別・プラットフォーム別フィルタリング）
- 作品詳細ページ
- 俳優詳細ページ
- ランキング表示
- 検索機能
- 配信スケジュールカレンダー（予定）

### 1.4 ターゲットユーザー
- BLドラマファン
- アジアドラマ視聴者
- 作品リサーチを行う人

### 1.5 デザインコンセプト
- シンプル・ミニマル
- Apple風のクリーンなデザイン
- モバイルファースト
- 日本語UIベース

---

## 2. 現在の進捗状況

### 2.1 完了済みタスク（✅）

#### データ準備
- ✅ 作品データベース作成（425作品 → 750作品に拡張）
- ✅ 俳優データベース作成（750人）
- ✅ CSVからGoogleスプレッドシートへ移行
- ✅ データ構造の整理・標準化

#### インフラ・環境構築
- ✅ GitHubリポジトリ作成（`asia-bl-archive`）
- ✅ Netlifyでのホスティング設定
- ✅ パスワード保護設定（Basic Auth）
- ✅ 自動デプロイ設定（GitHub → Netlify）

#### 自動化
- ✅ Google Apps Script（作品データ用）作成・設定
- ✅ Google Apps Script（俳優データ用）作成・設定
- ✅ `data/works.js` 自動生成機能
- ✅ `data/actors.js` 自動生成機能

#### デザイン・HTML
- ✅ トップページ（index.html）デザイン完成
- ✅ 作品詳細ページ（work-detail.html）プロトタイプ作成
- ✅ 俳優詳細ページ（actor-detail.html）プロトタイプ作成
- ✅ お知らせページ（news-page.html）プロトタイプ作成
- ✅ プライバシーポリシーページ作成
- ✅ お問い合わせページ作成

### 2.2 進行中のタスク（🔄）

- 🔄 index.htmlへのリンク機能追加（作品カード → 作品詳細ページ）
- 🔄 work-detail.htmlのデータ読み込み機能実装
- 🔄 actor-detail.htmlのデータ読み込み機能実装
- 🔄 ページ間の連携テスト

### 2.3 未着手タスク（❌）

- ❌ 画像アップロード・表示機能
- ❌ 検索機能の強化
- ❌ 全425件データのアップロード（現在10件テストデータのみ表示）
- ❌ レスポンシブデザインの最適化
- ❌ SEO対策
- ❌ Google Analytics設定
- ❌ AdSense広告設置

### 2.4 進捗率
**全体進捗: 約65%**

- データ準備: 100%
- インフラ: 100%
- 自動化: 100%
- デザイン: 90%
- 機能実装: 40%
- テスト: 10%

---

## 3. 技術スタック

### 3.1 フロントエンド
- **HTML5**: セマンティックHTML、アクセシビリティ対応
- **CSS3**: Flexbox、Grid、CSS Variables
- **JavaScript (Vanilla JS)**: フレームワーク不使用、シンプルな実装

### 3.2 データ管理
- **Google Sheets**: データベースとして使用
  - 作品データベース: 750件
  - 俳優データベース: 750人
- **Google Apps Script**: データ自動生成・GitHubへのプッシュ
- **JSON/JavaScript**: データ形式（works.js, actors.js）

### 3.3 バージョン管理・デプロイ
- **GitHub**: ソースコード管理
  - リポジトリ: `aoi-oxo/asia-bl-archive`
  - ブランチ戦略: `main` ブランチのみ
- **Netlify**: ホスティング
  - URL: `https://asia-bl-archive.netlify.app`
  - 自動デプロイ: GitHub push時に自動ビルド

### 3.4 認証・セキュリティ
- **Netlify Basic Auth**: パスワード保護
  - 理由: 開発中のため非公開
  - 設定: All deploys（本番・プレビュー全て）

### 3.5 開発ツール
- **テキストエディタ**: 任意（VSCode推奨）
- **ブラウザ**: Chrome（開発者ツール使用）

### 3.6 外部API・ライブラリ
- **現時点では不使用**
- 将来的な検討:
  - MyDramaList API（作品情報取得）
  - TMDB API（画像取得）
  - Google Analytics

---

## 4. ディレクトリ構造

### 4.1 現在の構造

```
asia-bl-archive/
├── README.md                      # プロジェクト説明
├── index.html                     # トップページ（作品一覧）
├── work-detail.html               # 作品詳細ページ（未実装）
├── actor-detail.html              # 俳優詳細ページ（未実装）
├── news-page.html                 # お知らせページ（静的）
├── privacy-policy.html            # プライバシーポリシー（静的）
├── contact-page.html              # お問い合わせページ（静的）
│
└── data/
    ├── works.js                   # 作品データ（750件）
    └── actors.js                  # 俳優データ（750人）
```

### 4.2 想定される将来の構造

```
asia-bl-archive/
├── README.md
├── index.html
├── work-detail.html
├── actor-detail.html
├── news-page.html
├── privacy-policy.html
├── contact-page.html
│
├── css/                           # （将来的に分離）
│   ├── main.css
│   └── responsive.css
│
├── js/                            # （将来的に分離）
│   ├── main.js
│   ├── work-detail.js
│   └── actor-detail.js
│
├── data/
│   ├── works.js
│   └── actors.js
│
├── images/                        # 作品・俳優画像
│   ├── works/
│   │   ├── love-in-the-air.jpg
│   │   └── ...
│   └── actors/
│       ├── boss-chaikamon.jpg
│       └── ...
│
└── docs/                          # ドキュメント
    ├── setup-guide.md
    └── api-documentation.md
```

---

## 5. データ構造

### 5.1 作品データ（works.js）

#### スプレッドシート構造
**URL:** https://docs.google.com/spreadsheets/d/1W-shoxrKWdlByjtUekTHUyaY4CN5aFpVra9wOXAl96Q/edit

**カラム一覧（50項目以上）:**

| カラム名 | データ型 | 説明 | 例 |
|---------|---------|------|-----|
| Country | String | 制作国 | South Korea, Thailand, Taiwan, China, Japan |
| Title_EN | String | 英語タイトル | Unintentional Love Story |
| Title_JP | String | 日本語タイトル | N/A（未入力可） |
| Title_Native | String | 現地語タイトル | 흔들리지 않고 피는 꽃이 어디 있으랴 |
| Year | Integer | 公開年 | 2023 |
| Source | String | 原作 | Webtoon |
| Episodes | Integer | 話数 | 10 |
| Director | String | 監督 | Kim Soo Jung |
| Writer | String | 脚本家 | Gongchan (Webtoon) |
| Genre | String | ジャンル | Romance; Drama; Pottery; Art; Korea; Webtoon |
| Platform | String | 配信プラットフォーム | iQIYI/Viki |
| Start_Date | DateTime | 配信開始日 | 2023-03-31T07:00:00.000Z |
| End_Date | DateTime | 配信終了日 | 2023-04-14T07:00:00.000Z |
| Air_Day | String | 放送曜日 | Friday |
| Air_Time_Local | String | 放送時間（現地） | 1899-12-31T02:00:00.000Z |
| Air_Time_JST | String | 放送時間（JST） | 1899-12-31T02:00:00.000Z |
| Timezone | String | タイムゾーン | KST |
| Release_Format | String | 配信形式 | Weekly (2 episodes) |
| Total_Episodes | Integer | 総話数 | 10 |
| Synopsis | String | あらすじ | Unintentional romance |
| Status | String | 配信状態 | Completed |
| Cast1_EN | String | キャスト1（英語） | Cha Seo Won |
| Cast1_Native | String | キャスト1（現地語） | ??? |
| Cast2_EN | String | キャスト2（英語） | Gongchan |
| Cast2_Native | String | キャスト2（現地語） | ??? |
| Cast3_EN | String | キャスト3（英語） | N/A |
| Cast3_Native | String | キャスト3（現地語） | N/A |
| Cast4_EN〜Cast10_EN | String | その他キャスト | ... |

**生成されるJavaScriptファイル（works.js）:**

```javascript
// 作品データ
// 最終更新: 2026/2/16 16:22:38
// 作品数: 750件

const allWorks = [
  {
    "Country": "South Korea",
    "Title_EN": "Unintentional Love Story",
    "Title_JP": "N/A",
    "Title_Native": "Unintentional Love Story",
    "Lang": "Korean",
    "Year": 2023,
    "Source": "Webtoon",
    "Episodes": 10,
    "Director": "Kim Soo Jung",
    "Writer": "Gongchan (Webtoon)",
    "Genre": "Romance; Drama; Pottery; Art; Korea; Webtoon",
    "Platform": "iQIYI",
    "Start_Date": "2023-03-31T07:00:00.000Z",
    "End_Date": "2023-04-14T07:00:00.000Z",
    "Air_Day": "Friday",
    "Air_Time_Local": "1899-12-31T02:00:00.000Z",
    "Air_Time_JST": "1899-12-31T02:00:00.000Z",
    "Timezone": "KST",
    "Release_Format": "Weekly (2 episodes)",
    "Total_Episodes": 10,
    "Synopsis": "Unintentional romance",
    "Status": "Completed",
    "Cast1_EN": "Cha Seo Won",
    "Cast1_Native": "???",
    "Cast2_EN": "Gongchan",
    "Cast2_Native": "???",
    "Cast3_EN": "N/A",
    // ... 他のフィールド
  },
  // ... 749件の作品
];
```

### 5.2 俳優データ（actors.js）

#### スプレッドシート構造
**URL:** https://docs.google.com/spreadsheets/d/1Fj6Pkmojxol9HX60bYTqatXhW8_u5orYuUP7iBoF5Vk/edit

**カラム一覧:**

| カラム名 | データ型 | 説明 | 例 |
|---------|---------|------|-----|
| Actor_ID | String | 俳優ID | ACT0001 |
| Name_JP | String | 日本語名 | フルーク・ナトゥーチ・シリポントン |
| Name_EN | String | 英語名 | Fluke Natouch Siripongthon |
| Name_Native | String | 現地語名 | ???? ????????? |
| Stage_Name | String | 芸名 | （空欄可） |
| Full_Name | String | 本名 | （空欄可） |
| Nationality | String | 国籍 | Thailand |
| Birthday | DateTime | 生年月日 | 1996-06-01T07:00:00.000Z |
| Age | Integer | 年齢 | 29 |
| Height | String | 身長 | 171cm |
| Blood_Type | String | 血液型 | A |
| Agency | String | 所属事務所 | Wabi Sabi |
| Profile_Text | String | プロフィール文 | BL俳優... |
| Instagram | String | Instagram URL | @flukenatouch0fficial |
| Twitter | String | Twitter URL | https://twitter.com/flukenatouch |
| TikTok | String | TikTok URL | https://www.tiktok.com/@Eflukenatouch0fficial |
| Facebook | String | Facebook URL | （空欄可） |
| YouTube | String | YouTube URL | （空欄可） |
| Weibo | String | Weibo URL | （空欄可） |
| Official_Site | String | 公式サイト | （空欄可） |
| Other_SNS | String | その他SNS | （空欄可） |
| Total_Works | String | 総出演作品数 | （空欄可） |
| Representative_Works | String | 代表作 | My Bromance, Until We Meet Again, The Effect |
| Works_List | String | 出演作品リスト | （空欄可） |
| Latest_Work | String | 最新作 | （空欄可） |
| Debut_Work | String | デビュー作 | My Bromance |
| Debut_Year | Integer | デビュー年 | 2014 |
| Awards_List | String | 受賞歴 | （空欄可） |
| Nominations_List | String | ノミネート歴 | （空欄可） |

**生成されるJavaScriptファイル（actors.js）:**

```javascript
// 俳優データ
// 最終更新: 2026/2/16 16:22:28
// 俳優数: 750人

const allActors = [
  {
    "Actor_ID": "ACT0001",
    "Name_JP": "???????????",
    "Name_EN": "Fluke Natouch Siripongthon",
    "Name_Native": "???? ?????????",
    "Stage_Name": "",
    "Full_Name": "",
    "Nationality": "Thailand",
    "Birthday": "1996-06-01T07:00:00.000Z",
    "Age": 29,
    "Height": "171cm",
    "Blood_Type": "A",
    "Agency": "Wabi Sabi",
    "Profile_Text": "???????BL????My Bromance??????Until We Meet Again??The Effect??????????????????????????",
    "Instagram": "@flukenatouch0fficial",
    "Twitter": "https://twitter.com/flukenatouch",
    "TikTok": "https://www.tiktok.com/@Eflukenatouch0fficial",
    "Facebook": "",
    "YouTube": "",
    "Weibo": "",
    "Official_Site": "",
    "Other_SNS": "",
    "Total_Works": "",
    "Representative_Works": "My Bromance, Until We Meet Again, The Effect",
    "Works_List": "",
    "Latest_Work": "",
    "Debut_Work": "My Bromance",
    "Debut_Year": 2014,
    "Awards_List": "",
    "Nominations_List": ""
  },
  // ... 749人の俳優
];
```

---

## 6. 環境設定

### 6.1 必要なアカウント

1. **Googleアカウント**
   - Gmail
   - Google Sheets へのアクセス
   - Google Apps Script の実行権限

2. **GitHubアカウント**
   - ユーザー名: `aoi-oxo`
   - リポジトリ: `asia-bl-archive`
   - Personal Access Token（権限: `repo`）

3. **Netlifyアカウント**
   - サイト名: `asia-bl-archive`
   - URL: `https://asia-bl-archive.netlify.app`
   - 課金プラン: Pro（パスワード保護のため）

### 6.2 Google Apps Script設定

#### 作品データ用スクリプト

**設定場所:**  
https://docs.google.com/spreadsheets/d/1W-shoxrKWdlByjtUekTHUyaY4CN5aFpVra9wOXAl96Q/edit  
→ 拡張機能 → Apps Script

**CONFIG設定:**

```javascript
const CONFIG = {
  githubUsername: 'aoi-oxo',
  githubRepo: 'asia-bl-archive',
  githubToken: 'ghp_あなたのトークン',  // 要変更
  outputFileName: 'data/works.js',
  sheetName: 'Sheet1'  // スプレッドシートのシート名に合わせる
};
```

**実行方法:**
1. スプレッドシートを開く
2. 上部メニュー「🌐 サイト更新」→「📤 作品データを反映」
3. 初回実行時は権限承認が必要

#### 俳優データ用スクリプト

**設定場所:**  
https://docs.google.com/spreadsheets/d/1Fj6Pkmojxol9HX60bYTqatXhW8_u5orYuUP7iBoF5Vk/edit  
→ 拡張機能 → Apps Script

**CONFIG設定:**

```javascript
const CONFIG = {
  githubUsername: 'aoi-oxo',
  githubRepo: 'asia-bl-archive',
  githubToken: 'ghp_あなたのトークン',  // 同じトークン
  outputFileName: 'data/actors.js',  // ★ ここが違う
  sheetName: 'Sheet1'  // スプレッドシートのシート名に合わせる
};
```

### 6.3 GitHub設定

**リポジトリURL:**  
https://github.com/aoi-oxo/asia-bl-archive

**ブランチ:**
- `main` - 本番用（Netlifyへ自動デプロイ）

**Personal Access Token:**
- 名前: Asia BL Archive
- 権限: `repo` (Full control of private repositories)
- 有効期限: 無期限（推奨）または90日

**トークン生成手順:**
1. GitHub → Settings（右上プロフィール）
2. Developer settings
3. Personal access tokens → Tokens (classic)
4. Generate new token (classic)
5. `repo` にチェック
6. Generate token
7. トークンをコピー（後で見られない！）

### 6.4 Netlify設定

**サイト設定:**
- Site name: `asia-bl-archive`
- Domain: `asia-bl-archive.netlify.app`
- Repository: `aoi-oxo/asia-bl-archive`
- Branch: `main`
- Build command: （空欄）
- Publish directory: `.`

**パスワード保護:**
- Project configuration → General → Visitor access
- Basic protection
- Access restricted to: All deploys
- パスワード: （設定済み）

**デプロイ設定:**
- Auto publishing: ON（GitHub pushで自動デプロイ）
- Build hooks: 未設定

---

## 7. 実装済み機能

### 7.1 データ管理機能

#### ✅ Googleスプレッドシート → JSON変換
- Apps Scriptによる自動変換
- データ検証（空行スキップ）
- 日本語・英語・現地語の多言語対応
- タイムスタンプ付きコメント生成

#### ✅ GitHub自動プッシュ
- REST API経由でのファイル更新
- SHA管理（既存ファイルの更新）
- エラーハンドリング

### 7.2 トップページ（index.html）

#### ✅ デザイン
- Apple風ミニマルデザイン
- グラデーションヒーローセクション
- カード型レイアウト
- レスポンシブ対応（一部）

#### ✅ 表示機能
- 作品一覧表示（グリッドレイアウト）
- ランキングTOP10表示（横スクロール）
- お知らせバナー
- 国別タブ（タイ・台湾・韓国・中国・日本）

#### ✅ フィルタリング機能
- 配信年フィルタ
- 配信月フィルタ
- プラットフォームフィルタ
- 国別フィルタ
- ソート機能（配信日時順・タイトル順・国別・配信サイト別）

#### ✅ 検索機能
- 作品名検索
- 俳優名検索
- リアルタイム検索（入力時に即座に反映）

#### ✅ データ読み込み
- `data/works.js` からの動的読み込み
- データマッピング（スプレッドシート → サイト表示形式）
- エラーハンドリング

### 7.3 作品詳細ページ（work-detail.html）

#### ✅ デザイン
- プロトタイプ完成
- ヒーローイメージエリア
- 作品情報セクション
- キャスト一覧
- レビューエリア（静的）

#### ❌ データ読み込み（未実装）
- URLパラメータからの作品ID取得
- `data/works.js` からのデータ抽出
- 動的コンテンツ生成

### 7.4 俳優詳細ページ（actor-detail.html）

#### ✅ デザイン
- プロトタイプ完成
- プロフィールヘッダー
- 出演作品一覧
- 受賞歴
- イベント情報
- 共演者リスト

#### ❌ データ読み込み（未実装）
- URLパラメータからの俳優ID取得
- `data/actors.js` からのデータ抽出
- 出演作品との紐付け

### 7.5 その他ページ

#### ✅ お知らせページ（news-page.html）
- 静的ページ
- お知らせ一覧表示

#### ✅ プライバシーポリシーページ（privacy-policy.html）
- 静的ページ
- 標準的なプライバシーポリシー

#### ✅ お問い合わせページ（contact-page.html）
- 静的ページ
- フォーム（未実装）

---

## 8. 未実装機能

### 8.1 ページ間リンク（優先度: 最高）

#### ❌ index.html → work-detail.html
- **現状:** 作品カードがdivタグ
- **必要な実装:**
  ```javascript
  // 作品カードを<a>タグに変更
  <a href="work-detail.html?id=love-in-the-air">
  ```

#### ❌ work-detail.html → actor-detail.html
- **現状:** 俳優名がテキストのみ
- **必要な実装:**
  ```javascript
  // 俳優名をリンク化
  <a href="actor-detail.html?id=boss-chaikamon">
  ```

#### ❌ actor-detail.html → work-detail.html
- **現状:** 出演作品がダミーデータ
- **必要な実装:**
  - `data/works.js` から該当作品を抽出
  - リンク付きカード生成

### 8.2 データ読み込み（優先度: 最高）

#### ❌ work-detail.htmlのJavaScript
```javascript
// 必要な実装:
<script src="data/works.js"></script>
<script>
// URLパラメータから作品IDを取得
const urlParams = new URLSearchParams(window.location.search);
const workId = urlParams.get('id');

// データ検索
const work = allWorks.find(w => 
  w.Title_EN.toLowerCase().replace(/\s+/g, '-') === workId
);

// DOM操作でデータ表示
document.querySelector('.work-title').textContent = work.Title_JP || work.Title_EN;
// ... 以下同様
</script>
```

#### ❌ actor-detail.htmlのJavaScript
```javascript
// 必要な実装:
<script src="data/actors.js"></script>
<script src="data/works.js"></script>
<script>
// URLパラメータから俳優IDを取得
const urlParams = new URLSearchParams(window.location.search);
const actorId = urlParams.get('id');

// 俳優データ検索
const actor = allActors.find(a => 
  a.Name_EN.toLowerCase().replace(/\s+/g, '-') === actorId
);

// 出演作品を検索
const actorWorks = allWorks.filter(w => 
  w.Cast1_EN === actor.Name_EN || w.Cast2_EN === actor.Name_EN
);

// DOM操作でデータ表示
// ... 
</script>
```

### 8.3 画像機能（優先度: 中）

#### ❌ 画像アップロード
- 作品ポスター画像
- 俳優プロフィール画像
- サムネイル生成

#### ❌ 画像最適化
- WebP変換
- レスポンシブ画像（srcset）
- Lazy loading

#### ❌ 外部API連携
- TMDB API（映画データベース）
- MyDramaList API（アジアドラマ情報）

### 8.4 検索機能強化（優先度: 中）

#### ❌ 高度な検索
- 複数条件の組み合わせ
- タグ検索
- ジャンル検索
- 俳優複数選択

#### ❌ 検索履歴
- LocalStorage活用
- 検索候補表示

### 8.5 ユーザー機能（優先度: 低）

#### ❌ お気に入り機能
- LocalStorage活用
- お気に入り一覧ページ

#### ❌ 視聴済みマーク
- 進捗管理

#### ❌ レビュー・評価
- ユーザーレビュー投稿
- 評価システム

### 8.6 その他（優先度: 低）

#### ❌ SEO対策
- メタタグ最適化
- OGP設定
- sitemap.xml
- robots.txt

#### ❌ Google Analytics
- ページビュー計測
- ユーザー行動分析

#### ❌ AdSense広告
- 広告枠設置
- 収益化

---

## 9. 開発フロー

### 9.1 データ更新フロー

```
1. Googleスプレッドシートでデータ編集
   ↓
2. 上部メニュー「🌐 サイト更新」→「📤 データを反映」
   ↓
3. Apps Scriptが実行される
   ↓
4. data/works.js または data/actors.js が更新される
   ↓
5. GitHubにコミット
   ↓
6. Netlifyが自動ビルド（2-3分）
   ↓
7. サイト更新完了
```

### 9.2 HTML/CSS修正フロー

```
1. ローカルでHTMLファイルを編集
   ↓
2. ブラウザでプレビュー・動作確認
   ↓
3. GitHubにコミット
   ↓
4. Netlifyが自動デプロイ
   ↓
5. 本番サイトで確認
```

### 9.3 トラブルシューティングフロー

```
問題発生
  ↓
1. ブラウザのコンソールを確認（F12）
  ↓
2. エラーメッセージを確認
  ↓
3. 該当ファイルの該当行を確認
  ↓
4. 修正
  ↓
5. 再度確認
```

---

## 10. トラブルシューティング

### 10.1 よくある問題と解決方法

#### 問題1: データが表示されない

**症状:**
- サイトを開いても作品が表示されない
- "作品が見つかりませんでした"と表示される

**原因と解決:**

1. **data/works.js が読み込まれていない**
   - ブラウザコンソールで確認: `console.log(typeof allWorks)`
   - `undefined` の場合: `<script src="data/works.js"></script>` の追加を確認
   - 解決: `<script>` タグを追加、または順序を修正

2. **データマッピングの不一致**
   - コンソールで確認: `console.log(allWorks[0])`
   - フィールド名が違う場合: マッピング処理を修正
   - 解決: `Title_EN` → `title` などの変換処理を確認

3. **フィルタ条件が厳しすぎる**
   - 年・月・国のフィルタをすべて「すべて」に変更してテスト
   - 解決: フィルタロジックを修正

#### 問題2: Apps Scriptでエラーが出る

**症状:**
- "Exceeded maximum execution time"
- "シートが見つかりません"
- "401 Unauthorized"

**原因と解決:**

1. **実行時間超過**
   - 原因: データ件数が多すぎる（750件）
   - 解決: バッチ処理に変更、または不要なフィールドを削除

2. **シート名の不一致**
   - 原因: `CONFIG.sheetName` が実際のシート名と違う
   - 解決: スプレッドシート下部のタブ名を確認、CONFIGを修正

3. **GitHubトークンの権限不足**
   - 原因: トークンに `repo` 権限がない
   - 解決: 新しいトークンを生成（権限: repo にチェック）

#### 問題3: Netlifyでデプロイされない

**症状:**
- GitHubにpushしてもサイトが更新されない
- Deploy failedと表示される

**原因と解決:**

1. **ビルド設定の問題**
   - 確認: Netlify → Deploys → Deploy log
   - 解決: Build command を空欄に、Publish directory を `.` に設定

2. **ファイルパスの問題**
   - 原因: ファイル名やパスが間違っている
   - 解決: 大文字小文字を確認、相対パスを修正

### 10.2 デバッグ方法

#### ブラウザコンソールの使い方

```javascript
// データ読み込み確認
console.log(allWorks);
console.log(allActors);

// 特定のデータ確認
console.log(allWorks[0]);

// データ件数確認
console.log(allWorks.length);

// フィルタリング結果確認
console.log(filtered);

// 変数の値確認
console.log(workId);
console.log(work);
```

#### エラーの読み方

```
Uncaught ReferenceError: allWorks is not defined
→ allWorks が定義されていない（data/works.js が読み込まれていない）

Uncaught TypeError: Cannot read properties of undefined
→ undefined のプロパティにアクセスしようとしている（データがnull/undefined）

Exceeded maximum execution time
→ Apps Scriptの実行時間が6分を超えた
```

---

## 11. 次のステップ

### 11.1 即座に実装すべきこと（優先度: 最高）

#### Step 1: ページ間リンクの実装（30分）

1. **index.htmlの修正**
   - 作品カードを `<div>` から `<a>` に変更
   - `href="work-detail.html?id=${workId}"` を追加
   - ランキングカードも同様に修正

2. **work-detail.htmlのスクリプト追加**
   - `</body>` の直前に以下を追加:
   ```html
   <script src="data/works.js"></script>
   <script>
   // URLパラメータから作品IDを取得
   const urlParams = new URLSearchParams(window.location.search);
   const workId = urlParams.get('id');
   
   if (typeof allWorks !== 'undefined' && workId) {
     const work = allWorks.find(w => {
       const titleUrl = (w.Title_EN || '').toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
       return titleUrl === workId;
     });
     
     if (work) {
       document.title = (work.Title_JP || work.Title_EN) + ' - Asia BL Archive';
       // ... DOM操作
     }
   }
   </script>
   ```

3. **actor-detail.htmlのスクリプト追加**
   - 同様にURLパラメータからデータを取得
   - `data/actors.js` と `data/works.js` の両方を読み込み

4. **動作確認**
   - トップページ → 作品詳細 → 俳優詳細 → 作品詳細（戻る）

### 11.2 短期目標（1週間以内）

- [ ] ページ間リンク完全実装
- [ ] 全750件のデータ表示（現在10件のみ）
- [ ] モバイル対応の改善
- [ ] 基本的なSEO対策

### 11.3 中期目標（1ヶ月以内）

- [ ] 画像アップロード機能
- [ ] 検索機能の強化
- [ ] お気に入り機能
- [ ] Google Analytics設定

### 11.4 長期目標（3ヶ月以内）

- [ ] ユーザー登録・ログイン機能
- [ ] レビュー・評価機能
- [ ] 外部API連携
- [ ] AdSense収益化

---

## 12. 重要な技術的詳細

### 12.1 作品ID・俳優IDの生成ルール

**作品ID:**
```javascript
// 例: "Love in the Air" → "love-in-the-air"
const workId = work.Title_EN
  .toLowerCase()
  .replace(/\s+/g, '-')
  .replace(/[^a-z0-9-]/g, '');
```

**俳優ID:**
```javascript
// 例: "Boss Chaikamon" → "boss-chaikamon"
const actorId = actor.Name_EN
  .toLowerCase()
  .replace(/\s+/g, '-')
  .replace(/[^a-z0-9-]/g, '');
```

### 12.2 データマッピング

**スプレッドシート → サイト表示:**

```javascript
// index.htmlでの変換
works = allWorks.map((w, i) => ({
  id: i + 1,
  title: w.Title_JP || w.Title_EN || w.Title_Native || '無題',
  country: mapCountry(w.Country),
  platform: mapPlatform(w.Platform),
  nextAir: w.Year ? `${w.Year}年` : '未定',
  thumbnail: w.Country ? `${getCountryName(w.Country)}BLドラマ` : '作品画像',
  actors: [w.Cast1_EN, w.Cast2_EN].filter(a => a && a.trim()),
  viewCount: Math.floor(Math.random() * 5000) + 500
}));
```

### 12.3 国名マッピング

```javascript
function mapCountry(country) {
  const mapping = {
    'Korea': 'korea',
    'South Korea': 'korea',
    'Thailand': 'thailand',
    'Taiwan': 'taiwan',
    'China': 'china',
    'Japan': 'japan',
    'Philippines': 'philippines'
  };
  return mapping[country] || (country || '').toLowerCase();
}

function getCountryName(country) {
  const names = {
    'Korea': '韓国',
    'South Korea': '韓国',
    'Thailand': 'タイ',
    'Taiwan': '台湾',
    'China': '中国',
    'Japan': '日本',
    'Philippines': 'フィリピン'
  };
  return names[country] || '海外';
}
```

### 12.4 プラットフォームマッピング

```javascript
function mapPlatform(platform) {
  if (!platform) return 'other';
  const first = platform.split('/')[0].trim();
  const platformMap = {
    'Netflix': 'netflix',
    'iQIYI': 'iqiyi',
    'Viki': 'viki',
    'GagaOOLala': 'gaga',
    'U-NEXT': 'unext',
    'Viu': 'viu',
    'GMMTV': 'gmmtv',
    'YouTube': 'youtube',
    'WeTV': 'wetv'
  };
  return platformMap[first] || 'other';
}
```

### 12.5 aoiのコーディングスタイル

#### 命名規則
- **変数名:** camelCase（例: `workId`, `allWorks`, `currentCountry`）
- **関数名:** camelCase（例: `renderWorks`, `mapCountry`, `getCountryName`）
- **定数:** UPPER_SNAKE_CASE（例: `CONFIG`）
- **CSS クラス名:** kebab-case（例: `work-card`, `ranking-scroll`）

#### コメント
- 日本語でわかりやすく
- 処理の意図を明確に
- 複雑なロジックには必ずコメント

#### コード構造
- シンプル・読みやすさ優先
- フレームワーク不使用（Vanilla JS）
- インラインスタイルは避ける（`<style>` タグ内に記述）
- DOM操作は `querySelector` を使用
- テンプレートリテラルを活用

#### エラーハンドリング
- `try-catch` で包む
- コンソールにエラーログ出力
- ユーザーフレンドリーなエラーメッセージ

---

## 13. 参考リンク

### 13.1 公式ドキュメント
- [Google Apps Script](https://developers.google.com/apps-script)
- [GitHub REST API](https://docs.github.com/en/rest)
- [Netlify Documentation](https://docs.netlify.com/)

### 13.2 スプレッドシート
- [作品データベース](https://docs.google.com/spreadsheets/d/1W-shoxrKWdlByjtUekTHUyaY4CN5aFpVra9wOXAl96Q/edit)
- [俳優データベース](https://docs.google.com/spreadsheets/d/1Fj6Pkmojxol9HX60bYTqatXhW8_u5orYuUP7iBoF5Vk/edit)

### 13.3 リポジトリ・サイト
- [GitHub リポジトリ](https://github.com/aoi-oxo/asia-bl-archive)
- [本番サイト](https://asia-bl-archive.netlify.app)

---

## 14. 更新履歴

| 日付 | 内容 | 担当 |
|------|------|------|
| 2026-02-11 | プロジェクト開始、データベース作成 | aoi |
| 2026-02-11 | GitHub・Netlify設定完了 | aoi + Claude |
| 2026-02-11 | Apps Script実装・テスト成功 | aoi + Claude |
| 2026-02-11 | index.html デザイン完成 | aoi + Claude |
| 2026-02-16 | 作品・俳優データ拡張（750件/750人） | aoi |
| 2026-02-16 | 本ドキュメント作成 | Claude |

---

## 15. 連絡先・サポート

**プロジェクトオーナー:** aoi (aoi-oxo)  
**GitHub:** https://github.com/aoi-oxo  
**サイト:** https://asia-bl-archive.netlify.app

---

**このドキュメントは、プロジェクトの引き継ぎや、新しい開発者の参加時に使用してください。**  
**質問や不明点があれば、GitHubのIssuesで管理することを推奨します。**

---

**Document Version:** 1.0  
**Last Updated:** 2026-02-16  
**Next Review:** 2026-03-16
